# 🤖 Semantic Tester 源码运行指南

<div align="center">

## 📚 开发者/源码用户使用指南

### 🌟 从零开始，掌握源码运行

#### 本指南将带您完成从环境搭建到源码运行的全过程

</div>

---

## 📑 目录

| 序号 | 内容                                    |
| ---- | --------------------------------------- |
| 1️⃣   | [准备工作](#1-准备工作)                 |
| 2️⃣   | [安装 VSCode](#2-安装-vscode)           |
| 3️⃣   | [安装 Python](#3-安装-python)           |
| 4️⃣   | [安装 uv 包管理器](#4-安装-uv-包管理器) |
| 5️⃣   | [安装 Git](#5-安装-git)                 |
| 6️⃣   | [获取代码](#6-获取代码)                 |
| 7️⃣   | [项目配置](#7-项目配置)                 |
| 8️⃣   | [运行程序](#8-运行程序)                 |
| 9️⃣   | [常见问题](#9-常见问题)                 |

---

## 1. ✅ 准备工作

在开始之前，请确保您的电脑满足以下要求：

| 📋 要求项目     | 📝 具体说明                  |
| --------------- | ---------------------------- |
| 💻 **操作系统** | Windows 10+ / macOS / Linux  |
| 🌐 **网络连接** | 稳定的互联网连接             |
| 💾 **磁盘空间** | 至少 2GB 可用空间            |
| � **权限要求**  | 管理员权限（安装软件时需要） |

---

## 2. 📝 安装 VSCode

### 🎯 什么是 VSCode？

VSCode（Visual Studio Code）是微软开发的免费代码编辑器，功能强大且易于使用。

### 📥 安装步骤：

1. **🌐 访问官网**

   - 访问：https://code.visualstudio.com/

2. **⬇️ 下载安装包**

   - 点击 "Download" 按钮下载对应系统的安装包。

3. **⚙️ 安装 VSCode**

   - 双击运行安装文件。
   - **推荐勾选** "添加到 PATH" 和 "添加到右键菜单"。
   - 一路点击 "下一步" 完成安装。

4. **🔧 推荐插件**
   - 打开 VSCode，点击左侧扩展图标（或按 `Ctrl+Shift+X`）。
   - 搜索并安装：
     - `Chinese (Simplified)` - 中文语言包
     - `Python` - Python 语言支持

---

## 3. � 安装 Python

### 🎯 什么是 Python？

Python 是一种流行的编程语言，本程序需要 Python 环境才能运行。

### 📥 安装步骤：

1. **🌐 访问官网**

   - 访问：https://www.python.org/downloads/

2. **⬇️ 下载安装包**

   - 下载最新版 Python（推荐 3.10 或更高版本）。

3. **⚙️ 安装 Python (关键步骤)**

   - 运行安装程序。
   - **⚠️ 务必勾选 "Add Python to PATH"**（将 Python 添加到环境变量）。
   - 点击 "Install Now" 进行安装。

4. **✅ 验证安装**
   - 打开终端（cmd 或 PowerShell）。
   - 输入 `python --version`，应显示版本号。

---

## 4. 📦 安装 uv 包管理器

### 🎯 什么是 uv？

uv 是一个极速的 Python 包管理器，能大幅提升依赖安装速度，自动管理虚拟环境。

### 📥 安装步骤：

#### Windows (PowerShell)

```powershell
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

#### macOS / Linux

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

**验证安装：**
重新打开终端，输入 `uv --version`，应显示版本号。

---

## 5. 📦 安装 Git

### 🎯 什么是 Git？

Git 是版本控制工具，用于下载和管理项目代码。

### 📥 安装步骤：

1. **🌐 访问官网**

   - Windows: https://git-scm.com/download/win
   - macOS: 通常自带，或通过 `xcode-select --install` 安装。

2. **⚙️ 安装**

   - 下载并运行安装程序，一路 "Next" 即可。

3. **✅ 验证安装**
   - 打开终端，输入 `git --version`。

---

## 6. 📥 获取代码

### 6.1 克隆项目

找一个您想存放代码的文件夹，右键选择 "Open in Terminal" (或 Git Bash Here)，执行：

```bash
git clone https://github.com/MisonL/semantic_tester.git
```

### 6.2 进入项目目录

```bash
cd semantic_tester
```

### 6.3 使用 VSCode 打开

```bash
code .
```

或者打开 VSCode，选择 "文件" -> "打开文件夹"，选择刚才克隆的 `semantic_tester` 目录。

---

## 7. ⚙️ 项目配置

### 7.1 安装依赖 (一键搞定)

在 VSCode 的终端中（`Ctrl + ~` 打开），执行：

```bash
uv sync
```

_uv 会自动创建虚拟环境（.venv）并安装所有所需的库（pandas, openai, rich 等）。_

### 7.2 配置文件设置（推荐使用 iFlow）

1. 在文件列表中找到 `.env.config.example`。
2. **复制并重命名**为 `.env.config`。
3. 打开 `.env.config`，填入您的配置。

#### 💡 推荐：使用 iFlow API（性价比之选）

iFlow 是一个国内的 AI API 聚合平台，具有以下优势：

- 💰 **价格实惠**：比官方 API 便宜 50% 以上
- 🚀 **速度快**：国内访问无需翻墙，响应迅速
- 🔧 **模型丰富**：支持 GPT-4、Claude、DeepSeek 等主流模型
- 📊 **额度充足**：新用户赠送免费额度

**iFlow 配置示例：**

```ini
# iFlow 配置（推荐）
IFLOW_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 可选：其他 AI 供应商
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_API_BASE=https://api.openai.com/v1
```

**如何获取 iFlow API Key：**

1. 访问 [iFlow 官网](https://iflow.cn)
2. 注册并登录账户
3. 进入"API Keys"页面
4. 点击"创建新密钥"，复制密钥到 `.env.config`

### 7.3 准备知识库

1. 在项目根目录下创建一个名为 `kb-docs` 的文件夹。
2. 将您的知识库文档（.txt, .md, .pdf）放入该文件夹。
   - _注意：文件名最好不要包含特殊字符。_

### 7.4 使用 dify_chat_tester 的批量询问结果（可选）

如果您已经使用 `dify_chat_tester` 项目进行了批量询问，可以直接将其输出的 Excel 文件用作本项目的输入，进行语义比对。

**工作流程：**

1. **使用 dify_chat_tester 生成问答记录**

   - 运行 `dify_chat_tester` 项目
   - 选择"批量询问模式"
   - 导入包含问题列表的 Excel 文件
   - 运行后会生成包含问题和 AI 回答的 Excel 文件（如 `batch_query_log_20251201_143000.xlsx`）

2. **使用 semantic_tester 进行语义比对**
   - 将上一步生成的 Excel 文件作为输入
   - 运行 `semantic_tester` 项目
   - 选择"批量测试模式"
   - 选择 `dify_chat_tester` 生成的 Excel 文件
   - 程序会自动比对 AI 回答与知识库文档的语义相似度

**Excel 文件格式要求：**

- 必须包含"问题"列（问题文本）
- 必须包含"回答"列（AI 回答文本）
- 可选包含"文档名称"列（指定匹配的知识库文档）

**示例：**

```bash
# 第一步：使用 dify_chat_tester 生成问答记录
cd dify_chat_tester
uv run main.py
# 选择批量询问模式，生成 batch_query_log_20251201_143000.xlsx

# 第二步：使用 semantic_tester 进行语义比对
cd ../semantic_tester
uv run main.py
# 选择批量测试模式，选择上述 Excel 文件
```

---

## 8. 🚀 运行程序

### 方式一：使用 uv 运行 (推荐)

这是最简单的方式，无需手动激活虚拟环境：

```bash
uv run main.py
```

### 方式二：手动激活环境运行

如果您习惯传统的 Python 运行方式：

**Windows:**

```powershell
.venv\Scripts\activate
python main.py
```

**macOS / Linux:**

```bash
source .venv/bin/activate
python main.py
```

---

## 9. ❓ 常见问题

### Q1: 运行报错 `Module not found`？

- **原因**：依赖未安装或未激活虚拟环境。
- **解决**：
  1. 确保执行了 `uv sync`。
  2. 推荐使用 `uv run main.py` 启动，它会自动处理环境问题。

### Q2: 提示 `uv` 不是内部或外部命令？

- **原因**：uv 安装路径未添加到环境变量，或安装后未重启终端。
- **解决**：重启 VSCode 或终端。如果仍无效，请尝试重新安装 uv。

### Q3: 无法读取 `.env.config`？

- **原因**：文件名错误或位置错误。
- **解决**：
  1. 确保文件名严格为 `.env.config`（注意前面的点）。
  2. Windows 用户请开启 "显示文件扩展名"，避免变成 `.env.config.txt`。
  3. 确保文件位于项目根目录（与 `main.py` 同级）。

### Q4: 知识库文档乱码或无法读取？

- **原因**：编码问题或格式不支持。
- **解决**：
  1. 推荐使用 UTF-8 编码的 .txt 或 .md 文件。
  2. PDF 文件请确保是文本型 PDF，而非扫描图片型 PDF。

---

<div align="center">
  <p>Happy Coding! 🚀</p>
</div>
