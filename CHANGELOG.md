# 📈 版本历史

## v4.0.0 (2025-12-23)

- 🚀 **多渠道并发处理架构**:
  - 全新的多渠道配置系统，支持 `AI_CHANNEL_*` 环境变量配置
  - 支持每个渠道独立配置 API 密钥、模型、并发数
  - 渠道级别的 API 密钥预校验，自动剔除失效渠道
  - `ProviderManager` 统一管理多渠道供应商生命周期
- ✨ **WorkerTableUI 全新交互体验**:

  - 全屏模式渲染，彻底消除终端残影问题
  - 实时显示当前处理问题和回复预览
  - 智能 JSON 解析，结果以 `是/否/不确定 | 理由` 格式友好展示
  - 简洁状态图标（🔍 分析中 / 💭 思考中 / ✅ 完成）
  - 所有列添加 `no_wrap` 防止内容换行

- 🧪 **测试套件全面升级**:

  - 修复 11 个过时测试，全部 79 个测试通过
  - 测试用例与当前 API 完全对齐
  - 移除对已删除方法的测试

- 🛠️ **代码质量提升**:
  - 修复 F401、F811、F821、F841、E722 等 Lint 错误
  - 清理废弃代码和临时文件
  - 优化 `iflow_provider.py` 流式响应处理

## v3.0.1

- 🏗️ **架构重构**:
  - **统一异常处理**：引入 `exceptions.py`，建立统一的异常处理机制和用户友好报错。
  - **依赖注入**：重构 `SemanticTestApp`，支持 `EnvManager` 和 `Config` 的依赖注入，提升代码可维护性。
- ⚡ **中断处理优化**:
  - 全局添加优雅退出机制，`Ctrl+C` 中断时显示友好提示。
  - 数据处理循环增加中断保护，确保中断时自动保存已处理的数据。
  - 新增定期保存机制（每处理 10 条数据自动保存一次），进一步保障数据安全。
- 🧪 **测试增强**:
  - 补充异常处理模块的单元测试，保持高测试覆盖率。

## v3.0.0

- 🆕 **UI 交互优化**:
  - 统一终端界面风格，优化确认提示（默认 Y/N）
  - 改进流式输出显示逻辑，优先展示问题与简略回答，随后展示思考过程
  - 语义比对结果面板新增 AI 回答内容显示
- ⚡ **性能提升**:
  - 优化启动流程，实现模块懒加载，显著提升启动速度
  - 新增启动加载动画，提升用户体验
- 🛠️ **工程优化**:
  - 完善 `.gitignore` 配置（忽略 `kb-docs` 等）
  - 修复 `main.py` 语法问题
  - 集成 `rich` 库增强终端显示效果
  - 新增 `coverage` 默认配置，统一 `semantic_tester` 包的覆盖率统计行为
  - `format_utils` 关键字高亮实现更健壮（使用回调替换，避免转义问题）
  - 清理旧版 `tests/verify_rotation.py`，并补充新的单元测试集，保证整体及各模块覆盖率均 ≥ 80%
- 🎨 **AI 提示词自定义** (新功能):
  - 支持通过 `.env.config` 配置文件自定义语义检查提示词
  - 新增 `SEMANTIC_CHECK_PROMPT` 配置项
  - 支持占位符替换：`{question}`, `{ai_answer}`, `{source_document}`
  - 用户可根据需求调整判断标准（更严格/更宽松/特定领域）
  - 详细配置文档：`AI_PROMPT_CONFIG.md`
- ✅ **原有特性 (v2.5+)**:
  - 完成模块化重构
  - 100% 类型安全 (Pylance 警告全部修复)
  - 代码质量达到生产标准
  - 多 AI 供应商支持 (Gemini, OpenAI, Dify, iFlow)
  - 统一供应商管理与灵活配置系统

## v2.0

- ✅ 模块化架构重构
- ✅ 配置管理系统
- ✅ 多种运行模式支持
- ✅ Dify 集成功能

## v1.0

- ✅ 基础语义比对功能
- ✅ Excel 处理功能
- ✅ API 密钥管理
